<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enquete</title>
    <script src="js/funcoes.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/enquete.css">
    <link rel="stylesheet" href="css/estilo.css">

</head>

<body>
    <!-- header -->
    <div class="header">
        <div class="container">
            <img src="https://logodownload.org/wp-content/uploads/2016/11/nba-logo-1.png" width="200px">
            <ul class="navbar">
                <li><a href="home_pos_login.html">Home</a></li>
                <li><a href="filmes.html">Filmes</a></li>
                <li><a href="animes.html">Animes</a></li>
                <li><a href="selecao_de_times.html">Times</a></li>
                <li><a href="">Enquetes</a></li>
            </ul>
        </div>
    </div>

    <!-- interior -->

    <div class="interior">
        <div class="container" id="div_enquete">
            
        </div>

    </div>

    <!-- footer  -->

    <div class="footer">
        <div class="container">
            <span>Club NBA - 2023</span>
        </div>
    </div>
</body>

</html>

<script>
    var quant_enquete = 0
    if(sessionStorage.ENQUETE_GOAT == 'null'){
        div_enquete.innerHTML +=`
        <div class="enquete" id="div_enquete_goat">
                <div class="alerta_erro">
                    <div class="card_erro" id="cardErro">
                        <span id="mensagem_erro"></span>
                    </div>
                </div>
                <h2>Qual é o melhor jogador de todos os tempos?</h2>
                <button id="botao1" onclick="cadastrar(botao1.innerHTML, 1)">Michael Jordan</button>
                <button id="botao2" onclick="cadastrar(botao2.innerHTML, 1)">Lebron James</button>
                <button id="botao3" onclick="cadastrar(botao3.innerHTML, 1)">Magic Johnson</button>
                <button id="botao4" onclick="cadastrar(botao4.innerHTML, 1)">Larry bird</button>
                <div id="div_aguardar" class="loading-div">
                    <img src="./assets/circle-loading.gif" id="loading-gif">
                </div>
            </div>
        `
        quant++
    }
    if(quant_enquete == 0){
        alert("você já votou em todas as enquetes")
        window.location = "home_pos_login.html"
    }
    
    function cadastrar(nomeJogador, numEnquete) {
        
        aguardar();

        var nome = nomeJogador;
        
        sessionStorage.ENQUETE = numEnquete;

        // Enviando o valor da nova input
        fetch("/enquete/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/enquete.js
                nomeServer: nome,
                idServer: sessionStorage.ID_USUARIO,
                enqueteServer: numEnquete
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = "Resposta de enquete registrada com sucesso!!!";

                sessionStorage.ENQUETE_GOAT = '1'

                setTimeout(() => {
                    window.location = "enquete.html";
                }, "2000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar a enquete!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;

        function sumirMensagem() {
            cardErro.style.display = "none"
        }
    }
</script>